<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ title or 'Somewheria, LLC.' }}</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800"/>
  <link rel="stylesheet" href="https://unpkg.com/@theme-toggles/react/css/Around.css" />
  <script>
    tailwind = { config: { darkMode: 'class' } }
  </script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    // Initialize theme immediately to prevent flash
    (function() {
      const storageKey = 'theme-preference';
      const getColorPreference = () => {
        if (localStorage.getItem(storageKey)) {
          return localStorage.getItem(storageKey);
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      };
      
      const theme = getColorPreference();
      document.documentElement.setAttribute('data-theme', theme);
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    })();
  </script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap");
    .bar1, .bar2, .bar3 {
      width: 35px;
      height: 3px;
      background-color: #111518;
      margin: 6px 0;
      transition: 0.4s;
    }
    #hamburger-icon {
      margin: auto 0;
      display: none;
      cursor: pointer;
    }
    #hamburger-icon.open .bar1 {
      -webkit-transform: rotate(-45deg) translate(-6px, 6px);
      transform: rotate(-45deg) translate(-6px, 6px);
    }
    #hamburger-icon.open .bar2 {
      opacity: 0;
    }
    #hamburger-icon.open .bar3 {
      -webkit-transform: rotate(45deg) translate(-6px, -8px);
      transform: rotate(45deg) translate(-6px, -8px);
    }
    #hamburger-icon .mobile-menu {
      display: none;
      position: absolute;
      top: 50px;
      left: 0;
      height: calc(100vh - 50px);
      width: 100%;
      background: #fff;
      color: #111518;
      transition: background 0.3s, color 0.3s;
    }
    #hamburger-icon.open .mobile-menu {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: #fff;
      color: #111518;
    }
    .mobile-menu li {
      margin-bottom: 10px;
    }
    .mobile-menu a {
      transition: color 0.3s, background 0.3s;
    }
    @media (prefers-color-scheme: dark) {
      #hamburger-icon .mobile-menu {
        background: #18181b !important;
        color: #fff !important;
      }
      #hamburger-icon.open .mobile-menu {
        background: #18181b !important;
        color: #fff !important;
      }
      .mobile-menu a {
        color: #fff !important;
      }
    }
    @media only screen and (max-width: 600px) {
      header nav.desktop-nav {
        display: none;
      }
      #hamburger-icon {
        display: block;
      }
    }
    @media only screen and (min-width: 601px) {
      #hamburger-icon {
        display: none !important;
      }
      nav.desktop-nav {
        display: block !important;
      }
    }
    /* Form transitions */
    form input, form textarea, form select {
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    form input:focus, form textarea:focus, form select:focus {
      outline: none;
      border-color: #2563eb;
      background: #f3f4f6;
      color: #111518;
    }
    @media (prefers-color-scheme: dark) {
      form input, form textarea, form select {
        background: #18181b;
        color: #fff;
        border-color: #27272a;
      }
      form input:focus, form textarea:focus, form select:focus {
        background: #27272a;
        color: #fff;
        border-color: #2563eb;
      }
    }
    @media (prefers-color-scheme: dark) {
      .bar1, .bar2, .bar3 {
        background-color: #fff !important;
      }
    }
    /* Theme Toggle Styles - Sun to Moon transformation */
    .theme-toggle {
      --icon-fill: #111518;
      --icon-fill-hover: #2563eb;
      cursor: pointer;
      display: inline-block;
      position: relative;
    }
    
    [data-theme="dark"] .theme-toggle {
      --icon-fill: #ffffff;
      --icon-fill-hover: #60a5fa;
    }
    
    .theme-toggle svg {
      fill: var(--icon-fill);
      transition: fill 0.3s ease;
    }
    
    .theme-toggle:hover svg {
      fill: var(--icon-fill-hover);
    }
    
    /* Sun to Moon Animation */
    .theme-toggle .sun {
      transition: all 0.5s ease;
    }
    
    .theme-toggle .sun-beams {
      transition: all 0.5s ease;
    }
    
    .theme-toggle .moon {
      transition: all 0.5s ease;
      opacity: 0;
      transform: scale(0.8);
    }
    
    /* Dark mode: Hide sun, show moon */
    [data-theme="dark"] .theme-toggle .sun {
      opacity: 0;
      transform: scale(0.8);
    }
    
    [data-theme="dark"] .theme-toggle .sun-beams {
      opacity: 0;
      transform: rotate(45deg);
    }
    
    [data-theme="dark"] .theme-toggle .moon {
      opacity: 1;
      transform: scale(1);
    }
    
    /* Screen reader text */
    .theme-toggle-sr {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Simple transitions for the new SVG */
    .theme-toggle svg circle,
    .theme-toggle svg g {
      transition: all 0.3s ease;
    }
    
    /* Hide/show elements based on theme */
    [data-theme="dark"] .sun-and-moon > .sun { 
      opacity: 0;
      transform: scale(0.8);
    }
    
    [data-theme="dark"] .sun-and-moon > .sun-beams { 
      opacity: 0;
    }
    
    [data-theme="dark"] .sun-and-moon > .moon { 
      opacity: 1;
      transform: scale(1);
    }
    
    [data-theme="light"] .sun-and-moon > .moon { 
      opacity: 0;
      transform: scale(0.8);
    }
    
    /* Transitions */
    .sun-and-moon > .sun,
    .sun-and-moon > .moon,
    .sun-and-moon > .sun-beams {
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    
    /* Force override browser dark mode settings */
    html[data-theme="light"] {
      background-color: #f5f5f5 !important;
      color: #111518 !important;
    }
    
    html[data-theme="light"] body {
      background-color: #f5f5f5 !important;
      color: #111518 !important;
    }
    
    html[data-theme="light"] .bg-neutral-100 {
      background-color: #f5f5f5 !important;
    }
    
    html[data-theme="light"] .bg-neutral-950 {
      background-color: #f5f5f5 !important;
    }

    html[data-theme="light"] .text-\[\#111518\] {
      color: #111518 !important;
    }

    html[data-theme="dark"] {
      background-color: #0a0a0a !important;
      color: #ffffff !important;
    }
    
    html[data-theme="dark"] body {
      background-color: #0a0a0a !important;
      color: #ffffff !important;
    }
    
    html[data-theme="dark"] .bg-neutral-100 {
      background-color: #0a0a0a !important;
    }
    
    html[data-theme="dark"] .bg-neutral-950 {
      background-color: #0a0a0a !important;
    }

    html[data-theme="dark"] .text-\[\#111518\] {
      color: #ffffff !important;
    }

    /* Force override for all elements */
    html[data-theme="light"] * {
      background-color: inherit !important;
      color: inherit !important;
    }
    
    html[data-theme="dark"] * {
      background-color: inherit !important;
      color: inherit !important;
    }
  </style>
  <!-- PWA manifest: always served at /manifest.webmanifest and /manifest.json for compatibility -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#111518">
  <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='web_light_rd_SI@1x.png') }}">
  <link rel="apple-touch-icon" sizes="384x384" href="{{ url_for('static', filename='web_light_rd_SI@1x.png') }}">
  <link rel="apple-touch-icon" sizes="512x512" href="{{ url_for('static', filename='web_light_rd_SI@1x.png') }}">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body style='font-family:"Plus Jakarta Sans","Noto Sans",sans-serif;'>
<div class="relative flex min-h-screen flex-col group/design-root overflow-x-hidden bg-neutral-100 dark:bg-neutral-950">
  <div class="layout-container flex h-full grow flex-col">
    <header class="flex items-center justify-between border-b px-4 sm:px-6 lg:px-10 py-3 w-full bg-neutral-100 dark:bg-neutral-900" style="position:relative;">
      <a id="brand" href="{{ url_for('home') }}" class="flex items-center gap-4 text-[#111518] dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 rounded">
        <div class="size-4">
          <svg viewBox="0 0 48 48" fill="none"><g clip-path="url(#clip0_6_535)">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M47.2426 24L24 47.2426L0.757355 24L24 0.757355L47.2426 24ZM12.2426 21H35.7574L24 9.24264L12.2426 21Z"
            fill="currentColor"></path></g>
            <defs><clipPath id="clip0_6_535"><rect width="48" height="48" fill="white"/></clipPath></defs>
          </svg>
        </div>
      </a>
      <nav class="desktop-nav flex-1 hidden sm:block" aria-label="Main navigation">
        <ul class="flex items-center gap-6 justify-center w-full">
          <li><a href="{{ url_for('home') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Home</a></li>
          <li><a href="{{ url_for('for_rent') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">For Rent</a></li>
          <li><a href="{{ url_for('about') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">About Us</a></li>
          <li><a href="{{ url_for('contact') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Contact Us</a></li>
          <li><a href="{{ url_for('register') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Register</a></li>
          {% if session.get('user') %}
            <li><a href="{{ url_for('manage_listings') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Manage Listings</a></li>
            {% set role = session.get('user', {}).get('role', '') %}
            {% if role in ['renter', 'admin', 'high_admin'] %}
              <li><a href="{{ url_for('renter_dashboard') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Renter Dashboard</a></li>
            {% endif %}
            {% if role == 'high_admin' %}
              <li><a href="{{ url_for('admin_dashboard_combined') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Admin Panel</a></li>
            {% endif %}
            <li class="flex items-center gap-2">
              {% if session.get('user', {}).get('picture') %}
                <img src="{{ session.get('user', {}).get('picture') }}" alt="Profile" class="w-6 h-6 rounded-full">
              {% endif %}
              <span class="text-[#111518] dark:text-white text-sm">{{ session.get('user', {}).get('name', 'User') }}</span>
            </li>
            <li><a href="{{ url_for('logout') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-red-600 dark:hover:text-red-400 px-3 py-2">Logout</a></li>
          {% else %}
            <li><a href="{{ url_for('login') }}" class="text-[#111518] dark:text-white text-sm font-medium leading-normal transition hover:bg-[#EAEDF1] dark:hover:bg-neutral-800 hover:rounded hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2">Login</a></li>
          {% endif %}
        </ul>
      </nav>
      <div class="flex flex-1 justify-end items-center">
        <!-- Theme Toggle Button -->
        <div class="theme-toggle mr-2" id="theme-toggle" title="Toggle theme">
          <span class="theme-toggle-sr">Toggle theme</span>
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="24" height="24" fill="currentColor" class="theme-toggle__around" viewBox="0 0 32 32">
            <!-- Sun circle -->
            <circle class="sun" cx="16" cy="16" r="8" />
            <!-- Sun beams -->
            <g class="sun-beams" stroke="currentColor" stroke-width="2" fill="none">
              <line x1="16" y1="2" x2="16" y2="4" />
              <line x1="16" y1="28" x2="16" y2="30" />
              <line x1="2" y1="16" x2="4" y2="16" />
              <line x1="28" y1="16" x2="30" y2="16" />
              <line x1="5.66" y1="5.66" x2="7.07" y2="7.07" />
              <line x1="24.93" y1="24.93" x2="26.34" y2="26.34" />
              <line x1="5.66" y1="26.34" x2="7.07" y2="24.93" />
              <line x1="24.93" y1="7.07" x2="26.34" y2="5.66" />
            </g>
            <!-- Moon (hidden by default) -->
            <circle class="moon" cx="20" cy="12" r="6" />
          </svg>
        </div>
        <div id="hamburger-icon" onclick="toggleMobileMenu(this)" aria-label="Open menu" tabindex="0" style="margin-left:auto;">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
          <ul class="mobile-menu bg-white text-[#111518] dark:bg-neutral-900 dark:text-white">
            <li><a href="{{ url_for('home') }}" class="text-[#111518] dark:text-white">Home</a></li>
            <li><a href="{{ url_for('for_rent') }}" class="text-[#111518] dark:text-white">For Rent</a></li>
            <li><a href="{{ url_for('about') }}" class="text-[#111518] dark:text-white">About Us</a></li>
            <li><a href="{{ url_for('contact') }}" class="text-[#111518] dark:text-white">Contact Us</a></li>
            <li><a href="{{ url_for('register') }}" class="text-[#111518] dark:text-white">Register</a></li>
            {% if session.get('user') %}
              <li><a href="{{ url_for('manage_listings') }}" class="text-[#111518] dark:text-white">Manage Listings</a></li>
              {% set role = session.get('user', {}).get('role', '') %}
              {% if role in ['renter', 'admin', 'high_admin'] %}
                <li><a href="{{ url_for('renter_dashboard') }}" class="text-[#111518] dark:text-white">Renter Dashboard</a></li>
              {% endif %}
              {% if role == 'high_admin' %}
                <li><a href="{{ url_for('admin_dashboard_combined') }}" class="text-[#111518] dark:text-white">Admin Panel</a></li>
              {% endif %}
              <li class="flex items-center gap-2 justify-center py-2">
                {% if session.get('user', {}).get('picture') %}
                  <img src="{{ session.get('user', {}).get('picture') }}" alt="Profile" class="w-6 h-6 rounded-full">
                {% endif %}
                <span class="text-[#111518] dark:text-white text-sm">{{ session.get('user', {}).get('name', 'User') }}</span>
              </li>
              <li><a href="{{ url_for('logout') }}" class="text-[#111518] dark:text-white">Logout</a></li>
            {% else %}
              <li><a href="{{ url_for('login') }}" class="text-[#111518] dark:text-white">Login</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </header>
    <script>
      function toggleMobileMenu(menu) {
        menu.classList.toggle('open');
      }
    </script>
    <main class="flex-1 bg-neutral-100 text-[#111518] dark:bg-neutral-950 dark:text-white">{% block content %}{% endblock %}</main>
    <footer class="py-5 text-center bg-gray-100 text-gray-600 dark:bg-neutral-900 dark:text-gray-300">
      <p class="mb-2">&copy; 2024/25 Somewheria, LLC. All Rights Reserved.</p>
      <div>
        <a href="{{ url_for('report_issue_form') }}" class="text-blue-600 dark:text-blue-400 underline text-sm">Report an issue</a>
      </div>
    </footer>
  </div>
</div>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/service-worker.js').catch(function(err){
        console.log('SW registration failed', err);
      });
    });
  }
</script>
<!-- Fixed Theme Toggle JavaScript -->
<script>
  const storageKey = 'theme-preference';
  
  const getColorPreference = () => {
    if (localStorage.getItem(storageKey)) {
      return localStorage.getItem(storageKey);
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  };
  
  const setPreference = (theme) => {
    localStorage.setItem(storageKey, theme);
    document.documentElement.setAttribute('data-theme', theme);
    document.querySelector('#theme-toggle')?.setAttribute('aria-label', theme);
    
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };
  
  const onClick = () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    setPreference(newTheme);
  };
  
  // Initialize theme
  const initialTheme = getColorPreference();
  setPreference(initialTheme);
  
  // Add click listener
  document.addEventListener('DOMContentLoaded', () => {
    const toggleBtn = document.querySelector('#theme-toggle');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', onClick);
    }
  });
  
  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ({matches: isDark}) => {
    if (!localStorage.getItem(storageKey)) {
      setPreference(isDark ? 'dark' : 'light');
    }
  });
</script>
</body>
</html>
